# Basic Insert
mutation BasicInsert @auth(level: NO_ACCESS) {
  _executeReturningFirst(sql: "INSERT INTO restaurant (name, active) VALUES ('Simpjlej Resto1', true) RETURNING id, name")
}

# Complex Insert
mutation InsertComplex($name: String!, $meta: Any!, $tags: [String!]) @auth(level: NO_ACCESS) {
  _execute(
    sql: "INSERT INTO restaurant (name, active, metadata, tags) VALUES ($1, true, $2, $3)",
    params: [$name, $meta, $tags]
  )
}

# Bulk Insert
mutation BulkInsert @auth(level: NO_ACCESS) {
  _execute(sql: "INSERT INTO restaurant (name, active) VALUES ('A', true), ('B', false)")
}

# Insert from Select
mutation CopyInsert @auth(level: NO_ACCESS) {
  _execute(sql: "INSERT INTO restaurant (name, active) SELECT name || '_Copy', active FROM restaurant WHERE id=1")
}

# Upsert
mutation Upsert($id: Int!, $name: String!) @auth(level: NO_ACCESS) {
  _execute(
    sql: "INSERT INTO restaurant (id, name, active) VALUES ($1, $2, true) ON CONFLICT (id) DO UPDATE SET name = EXCLUDED.name",
    params: [$id, $name]
  )
}

# Basic Update
mutation BasicUpdate($id: Int) @auth(level: NO_ACCESS) {
  _execute(sql: "UPDATE restaurant SET active = false WHERE id = $1", params: [$id])
}

# Multi-column Update
mutation UpdateMulti($id: Int!, $name: String!, $active: Boolean!) @auth(level: NO_ACCESS) {
  _execute(sql: "UPDATE restaurant SET name=$2, active=$3 WHERE id=$1", params: [$id, $name, $active])
}

# Update via Join
mutation UpdateJoin @auth(level: NO_ACCESS) {
  _execute(sql: "UPDATE restaurant SET active=false WHERE id IN (SELECT restaurant_id FROM review WHERE rating < 2)")
}

# Update Zero Rows
mutation UpdateNone @auth(level: NO_ACCESS) {
  _execute(sql: "UPDATE restaurant SET active=false WHERE id = -999")
}

# Basic Delete
mutation BasicDelete($id: Int) @auth(level: NO_ACCESS) {
  _execute(sql: "DELETE FROM restaurant WHERE id = $1", params: [$id])
}

# Delete Many
mutation DeleteMany @auth(level: NO_ACCESS) {
  _execute(sql: "DELETE FROM restaurant WHERE name LIKE '%Copy%'")
}

# ------------------------------------------------------------------------------
# RETURNING MUTATIONS
# ------------------------------------------------------------------------------

# Insert Returning First
mutation InsertReturnOne($name: String!) @auth(level: NO_ACCESS) {
  _executeReturningFirst(
    sql: "INSERT INTO restaurant (name, active) VALUES ($1, true) RETURNING id, name",
    params: [$name]
  )
}

# Update Returning
mutation UpdateReturnMany @auth(level: NO_ACCESS) {
  _executeReturning(
    sql: "UPDATE review SET rating = rating + 0.1 WHERE rating < 3 RETURNING id, rating"
  )
}

# Delete Returning
mutation DeleteReturnMany @auth(level: NO_ACCESS) {
  _executeReturning(
    sql: "DELETE FROM review WHERE content IS NULL RETURNING id"
  )
}

# Update with Auth Context
mutation UpdateAuth($id: Int!, $name: String!) @auth(level: USER) {
  _executeReturningFirst(
    sql: "UPDATE restaurant SET name=$2 WHERE id=$1 AND owner_uid=$3 RETURNING *",
    params: [$id, $name, {_expr: "auth.uid"}]
  )
}

# Invalid JSON
mutation BadJson @auth(level: NO_ACCESS) {
  _execute(sql: "INSERT INTO restaurant (name, active, metadata) VALUES ('BadJsonResto', true, '{bad_json: }')")
}
